<script type="module">
  import { WALLETCONNECT_PROJECT_ID, NEYNAR_API_KEY } from "./config.js";
  import { createWeb3Modal, defaultWagmiConfig } from "https://unpkg.com/@web3modal/wagmi@3?module";
  import { base } from "https://unpkg.com/viem/chains@2?module";

  const btnWallet = document.getElementById("btnWallet");
  const btnFarcaster = document.getElementById("btnFarcaster");
  const btnPlay = document.getElementById("btnPlay");

  let walletConnected = false;
  let farcasterConnected = false;

  // === WALLET ===
  const wagmiConfig = defaultWagmiConfig({
    chains: [base],
    projectId: WALLETCONNECT_PROJECT_ID,
    metadata: {
      name: "WAQIT GAME PORTAL",
      description: "Portal Game Futuristik",
      url: location.origin,
      icons: ["/logo.png"]
    }
  });
  createWeb3Modal({
    wagmiConfig,
    projectId: WALLETCONNECT_PROJECT_ID,
    chains: [base]
  });

  btnWallet.addEventListener("click", async () => {
    // panggil modal wallet
    walletConnected = true; // TODO: lo bisa cek state asli dari web3modal
    btnWallet.innerText = "✅ Wallet Connected";
    checkReady();
  });

  // === FARCASTER ===
  btnFarcaster.addEventListener("click", async () => {
    try {
      const res = await fetch("https://api.neynar.com/v2/farcaster/user", {
        headers: { "api_key": NEYNAR_API_KEY }
      });
      if (res.ok) {
        farcasterConnected = true;
        btnFarcaster.innerText = "✅ Farcaster Connected";
        checkReady();
      } else {
        alert("Login Farcaster gagal");
      }
    } catch (err) {
      console.error(err);
      alert("Error login Farcaster");
    }
  });

  // === CEK KEDUANYA ===
  function checkReady() {
    if (walletConnected && farcasterConnected) {
      btnPlay.disabled = false;
    }
  }

  // === MAIN GAME ===
  btnPlay.addEventListener("click", () => {
    window.location.href = "/games/snake/index.html";
  });
</script>
